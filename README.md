# Alice Thornton project code

[![Build Site](https://github.com/kingsdigitallab/alice-thornton/actions/workflows/build.yml/badge.svg)](https://github.com/kingsdigitallab/alice-thornton/actions/workflows/build.yml)
[![TEI Validation](https://github.com/kingsdigitallab/alice-thornton/actions/workflows/validate-tei.yml/badge.svg?branch=edition)](https://github.com/kingsdigitallab/alice-thornton/actions/workflows/validate-tei.yml)

Open in Gitpod: [design branch](https://gitpod.io/#https://github.com/kingsdigitallab/alice-thornton/tree/design) | [develop branch](https://gitpod.io/#https://github.com/kingsdigitallab/alice-thornton/tree/develop)

The web site is developed using a Static Site Generator called [11ty](https://www.11ty.dev/).

- [Documentation for editors](https://github.com/kingsdigitallab/vault-101/blob/main/docs/howto/editing-markdown-files-on-github.rst)
- [Documentation for developers](https://github.com/kingsdigitallab/vault-101/blob/main/docs/howto/11ty.rst)

## Site deployment

- [The live/public site](//thornton.kdl.kcl.ac.uk) is generated from the `main` branch every 30 minutes. Researchers can edit the markdown content of the site directly on this branch.
- [The staging site](//thornton-stg.kdl.kcl.ac.uk) is generated from the `release` branch every 30 minutes.
  This branch and site are used by the KDL team to test and demonstrate new features and fixes before publishing them to `main` branch.
- [The development site](//thornton-dev.kdl.kcl.ac.uk) is generated from the `develop` branch every 30 minutes.
  This branch and site are used by the KDL team to experiment with new, unstable features.

## Edition

- [The TEI editions of the books](https://github.com/kingsdigitallab/alice-thornton/tree/edition) are manually edited in the `edition` branch
- [The HTML chunks](https://github.com/kingsdigitallab/alice-thornton/tree/dts) are generated from the TEI editions every day at 1pm & 6pm and saved into the `dts` branch by a [github workflow (`publish-tei.yml`)](https://github.com/kingsdigitallab/alice-thornton/actions/workflows/publish-tei.yml)
- The staging (and development) [Text Viewer](https://thornton-stg.kdl.kcl.ac.uk/books/viewer/) reads HTML chunks from the `dts` branch
- The live [Text Viewer](https://thornton.kdl.kcl.ac.uk/books/viewer/) reads HTML chunks from the `dts-liv` branch. Which is a snapshot done manually from the `dts` branch before a live/public release.

## Indices

- `frontend/assets/js/entities.json`: the index of entities generated from the entities TEI files in the `dts` branch. This json file is generated on the `release` branch by a github workflow (`index-entities.yml`) at 9am, 1pm and 6pm. This index is used by the Entities tab in the side drawer of the text viewer and by the Index page.
- `frontend/assets/js/events.json`: the index of events generated from the `entities.json` and other manually updated json files. This json file is generated on the `release` branch by a github workflow (`index-entities.yml`). This index is used by the Timeline page.
- `frontend/_site/pagefind/`: the full text index of the four editions (modern and semi-diplomatic version). It is generated by Pagefind library from HTML files produced by `/apps/textsearch/textsearch.js`. Those HTML files are derived from the html chunks found in the `dts` branch (see above). That indexing is done each time a site is deployed.

## Other [workflows](https://github.com/kingsdigitallab/alice-thornton/tree/main/.github/workflows)

There are two other workflows on github: build and validate-tei. Those are for validation only, they don't produce any output for the site.

## Developing the DTS server

To edit the code of the DTS server locally while testing it with the AT Text Viewer on the AT edition:

1. git clone [kdl-dts-server](https://github.com/kingsdigitallab/kdl-dts-server) in a new folder outside the project
2. Start the server: `npm run start:at` (will run on localhost:3000)

## Server build for each type (dev|stg|liv) of site:

`export SITE_ENV='dev'; npm run rebuild`
